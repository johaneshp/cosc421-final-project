---
title: "Impact Analysis: Key Research Questions"
author: "Jinxi_Hu-48528608, Samarth_Grover-38220463"
date: "November 25, 2025"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)
```

## Environment Setup

```{r load-libraries, message = FALSE, warning = FALSE}
library(readr)
library(igraph)
library(RColorBrewer)
library(ggplot2)
library(reshape2)
library(scales)
library(dplyr)
library(knitr)
library(wordcloud)
library(RColorBrewer)
set.seed(48528608)

# Create output directory
if (!dir.exists("plots")) {
  dir.create("plots", recursive = TRUE)
}
```

```{r load-data}
# Load data
nodes_connected <- read.csv("data/nodes_connected.csv")
edges_connected <- read.csv("data/edges_connected.csv")
nodes_all_raw <- read.csv("data/nodes.csv")

# Filter out invalid nodes from nodes_all
nodes_all <- nodes_all_raw %>%
  filter(
    !is.na(title) & trimws(title) != "",  # Valid title
    !is.na(local_id),                     # Valid ID
    !is.na(year) & year > 1900 & year <= 2025,  # Valid year range
    !is.na(citations) & citations >= 0,   # Valid citation count
    !is.na(references) & references >= 0, # Valid reference count
    !is.na(subtopic) & trimws(subtopic) != "",  # Valid subtopic
    !is.na(institution) & trimws(institution) != ""  # Valid institution
  )

# Create graph
graph <- graph_from_data_frame(edges_connected, vertices = nodes_connected, directed = TRUE)
graph <- simplify(graph, remove.multiple = TRUE, remove.loops = TRUE)

# Calculate centrality metrics
V(graph)$in_degree <- degree(graph, mode="in")
V(graph)$out_degree <- degree(graph, mode="out")
V(graph)$pagerank <- page_rank(graph, directed = TRUE)$vector
V(graph)$betweenness <- betweenness(graph, directed = TRUE, normalized = TRUE)
V(graph)$closeness_in <- closeness(graph, mode = "in", normalized = TRUE)
V(graph)$eigenvector <- eigen_centrality(graph, directed = TRUE)$vector

# Add centrality metrics to nodes dataframe
nodes_analysis <- nodes_connected
nodes_analysis$in_degree <- V(graph)$in_degree
nodes_analysis$out_degree <- V(graph)$out_degree
nodes_analysis$pagerank <- V(graph)$pagerank
nodes_analysis$betweenness <- V(graph)$betweenness
nodes_analysis$closeness_in <- V(graph)$closeness_in
nodes_analysis$eigenvector <- V(graph)$eigenvector
```

# 1. Which paper is the most impactful?

```{r most-impactful-paper}
cat("=== Most Impactful Paper Analysis ===\n\n")

# Find most impactful papers using PageRank as the primary metric
top_by_pagerank <- nodes_analysis[order(nodes_analysis$pagerank, decreasing = TRUE), ][1:15, ]

# Additional metrics for comparison (but PageRank is the main criterion)
top_by_citations <- nodes_analysis[order(nodes_analysis$citations, decreasing = TRUE), ][1:10, ]
top_by_indegree <- nodes_analysis[order(nodes_analysis$in_degree, decreasing = TRUE), ][1:10, ]

# Use PageRank as the primary impact measure
top_impact <- top_by_pagerank

cat("Most impactful papers ranked by PageRank:\n")
# Truncate long titles and institution names for better display
top_impact_display <- top_impact[1:10, ]
top_impact_display$title_short <- substr(top_impact_display$title, 1, 50)
top_impact_display$institution_short <- substr(top_impact_display$institution, 1, 20)
top_impact_display$pagerank_rounded <- round(top_impact_display$pagerank, 6)

kable(top_impact_display[, c("title_short", "year", "pagerank_rounded", "citations", "in_degree", "institution_short")],
      col.names = c("Title", "Year", "PageRank", "Citations", "In-Degree", "Institution"))

cat("\nTop 5 papers by citation count (for comparison):\n")
top_citations_display <- top_by_citations[1:5, ]
top_citations_display$title_short <- substr(top_citations_display$title, 1, 50)
top_citations_display$institution_short <- substr(top_citations_display$institution, 1, 20)

kable(top_citations_display[, c("title_short", "year", "citations", "institution_short")],
      col.names = c("Title", "Year", "Citations", "Institution"))

# Visualize impact metrics with PageRank as primary focus
impact_comparison <- data.frame(
  Paper = paste("Paper", 1:10),
  Title_Short = substr(top_impact$title[1:10], 1, 40),
  PageRank = top_impact$pagerank[1:10] * 1000, # scaled for visualization
  Citations = top_impact$citations[1:10],
  InDegree = top_impact$in_degree[1:10]
)

impact_melted <- reshape2::melt(impact_comparison[, c("Paper", "PageRank", "Citations", "InDegree")], 
                               id.vars = "Paper")

p1 <- ggplot(impact_melted, aes(x = Paper, y = value, fill = variable)) +
  geom_bar(stat = "identity", position = "dodge") +
  coord_flip() +
  labs(title = "Top 10 Papers by PageRank (Primary Metric)",
       subtitle = "PageRank scaled for visualization, with citations and in-degree for comparison",
       x = "Papers (ranked by PageRank)",
       y = "Metric Value",
       fill = "Metric") +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5),
        plot.subtitle = element_text(hjust = 0.5))

ggsave("plots/impact_metrics_comparison.png", plot = p1, width = 12, height = 8, dpi = 150)
print(p1)
```

# 2. Which is the oldest paper that's still very relevant until now?

```{r oldest-relevant-papers}
cat("\n=== Oldest But Still Relevant Papers ===\n\n")

# Filter older papers (e.g., before 1995) that still have high impact
old_papers <- nodes_analysis[nodes_analysis$year <= 1995 & !is.na(nodes_analysis$year), ]

if(nrow(old_papers) > 0) {
  # Sort by impact metrics
  old_papers_by_citations <- old_papers[order(old_papers$citations, decreasing = TRUE), ]
  old_papers_by_indegree <- old_papers[order(old_papers$in_degree, decreasing = TRUE), ]
  old_papers_by_pagerank <- old_papers[order(old_papers$pagerank, decreasing = TRUE), ]
  
  cat("High-impact papers published in 1995 or earlier (by citation count):\n")
  if(nrow(old_papers_by_citations) > 0) {
    kable(head(old_papers_by_citations[, c("title", "year", "citations", "in_degree", "institution", "subtopic")], 10))
  }
  
  # Visualize relationship between age and impact
  yearly_impact <- nodes_analysis %>%
    filter(!is.na(year), year >= 1980, year <= 2020) %>%
    group_by(year) %>%
    summarise(
      avg_citations = mean(citations, na.rm = TRUE),
      avg_in_degree = mean(in_degree, na.rm = TRUE),
      paper_count = n(),
      max_citations = max(citations, na.rm = TRUE)
    )
  
  p2 <- ggplot(yearly_impact, aes(x = year)) +
    geom_line(aes(y = avg_citations, color = "Average Citations"), size = 1) +
    geom_line(aes(y = max_citations/10, color = "Max Citations (scaled)"), size = 1) +
    geom_bar(aes(y = paper_count), alpha = 0.3, stat = "identity") +
    scale_y_continuous(
      name = "Citations / Paper Count",
      sec.axis = sec_axis(~.*10, name = "Max Citations")
    ) +
    labs(title = "Research Impact Over Time",
         subtitle = "Average citations, maximum citations, and paper count by year",
         x = "Year",
         color = "Metric") +
    theme_minimal() +
    theme(plot.title = element_text(hjust = 0.5),
          plot.subtitle = element_text(hjust = 0.5))
  
  ggsave("plots/impact_over_time.png", plot = p2, width = 12, height = 6, dpi = 150)
  print(p2)
} else {
  cat("No papers found from 1995 or earlier\n")
}

# Examine earliest high-impact papers
earliest_high_impact <- nodes_analysis[nodes_analysis$citations >= quantile(nodes_analysis$citations, 0.9, na.rm = TRUE) | 
                                      nodes_analysis$in_degree >= quantile(nodes_analysis$in_degree, 0.9, na.rm = TRUE), ]
earliest_high_impact <- earliest_high_impact[order(earliest_high_impact$year), ]

cat("\nEarliest high-impact papers (citations or in-degree in top 10%):\n")
kable(head(earliest_high_impact[, c("title", "year", "citations", "in_degree", "institution", "subtopic")], 10))
```

# 3. What subtopics have the highest concentration of research?

```{r research-concentration}
cat("\n=== Research Subtopic Concentration Analysis ===\n\n")

# Analyze distribution of research subtopics
subtopic_stats <- nodes_all %>%
  group_by(subtopic) %>%
  summarise(
    paper_count = n(),
    avg_citations = mean(citations, na.rm = TRUE),
    total_citations = sum(citations, na.rm = TRUE),
    unique_institutions = n_distinct(institution, na.rm = TRUE),
    year_span = ifelse(all(is.na(year)), 0, max(year, na.rm = TRUE) - min(year, na.rm = TRUE)),
    latest_year = ifelse(all(is.na(year)), NA, max(year, na.rm = TRUE))
  ) %>%
  arrange(desc(paper_count))

# Calculate concentration index (Herfindahl-Hirschman Index)
total_papers <- nrow(nodes_all)
subtopic_stats$concentration_index <- (subtopic_stats$paper_count / total_papers)^2

cat("Research subtopics ranked by paper count:\n")
kable(head(subtopic_stats, 15))

# Visualize research concentration
p3 <- ggplot(head(subtopic_stats, 20), aes(x = reorder(subtopic, paper_count), y = paper_count)) +
  geom_bar(stat = "identity", fill = "steelblue", alpha = 0.7) +
  coord_flip() +
  labs(title = "Research Concentration by Subtopic",
       subtitle = "Top 20 research subtopics by number of papers",
       x = "Research Subtopic",
       y = "Number of Papers") +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5),
        plot.subtitle = element_text(hjust = 0.5),
        axis.text.y = element_text(size = 8))

ggsave("plots/research_concentration_by_subtopic.png", plot = p3, width = 12, height = 8, dpi = 150)
print(p3)

# Impact vs volume scatter plot
p4 <- ggplot(subtopic_stats, aes(x = paper_count, y = avg_citations)) +
  geom_point(aes(size = total_citations, color = unique_institutions), alpha = 0.6) +
  geom_text(aes(label = ifelse(paper_count > 100 | avg_citations > quantile(avg_citations, 0.9, na.rm = TRUE), 
                               substr(subtopic, 1, 15), "")), 
            hjust = 0, vjust = 0, size = 3, check_overlap = TRUE) +
  scale_color_gradient(low = "lightblue", high = "darkblue", name = "Unique\nInstitutions") +
  scale_size_continuous(name = "Total\nCitations") +
  labs(title = "Research Subtopic Analysis: Volume vs Impact",
       subtitle = "Size = Total citations, Color = Number of unique institutions",
       x = "Number of Papers",
       y = "Average Citations per Paper") +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5),
        plot.subtitle = element_text(hjust = 0.5))

ggsave("plots/subtopic_volume_vs_impact.png", plot = p4, width = 12, height = 8, dpi = 150)
print(p4)

# Word cloud showing main research areas
if(nrow(subtopic_stats) > 0) {
  png("plots/research_subtopics_wordcloud.png", width = 800, height = 600, res = 150)
  wordcloud(words = subtopic_stats$subtopic, 
           freq = subtopic_stats$paper_count, 
           min.freq = 1,
           max.words = 100, 
           random.order = FALSE, 
           rot.perc = 0.35,
           colors = brewer.pal(8, "Dark2"))
  dev.off()
}
```

# 4. Which country/institution has the most research output?

```{r research-output}
cat("\n=== Research Output Analysis ===\n\n")

# Extract country information (assuming it can be inferred from institution names)
# This needs to be adjusted based on actual data format
nodes_all$country <- NA  # needs to be filled based on actual situation

# Analyze by institution
institution_stats <- nodes_all %>%
  filter(!is.na(institution) & institution != "") %>%
  group_by(institution) %>%
  summarise(
    paper_count = n(),
    avg_citations = mean(citations, na.rm = TRUE),
    total_citations = sum(citations, na.rm = TRUE),
    latest_year = ifelse(all(is.na(year)), NA, max(year, na.rm = TRUE)),
    research_areas = n_distinct(subtopic, na.rm = TRUE)
  ) %>%
  arrange(desc(paper_count))

cat("Institutions with highest research output (top 20):\n")
kable(head(institution_stats, 20))

# Visualize institutional output
p5 <- ggplot(head(institution_stats, 15), aes(x = reorder(institution, paper_count), y = paper_count)) +
  geom_bar(stat = "identity", fill = "darkgreen", alpha = 0.7) +
  coord_flip() +
  labs(title = "Research Output by Institution",
       subtitle = "Top 15 institutions by number of papers",
       x = "Institution",
       y = "Number of Papers") +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5),
        plot.subtitle = element_text(hjust = 0.5),
        axis.text.y = element_text(size = 8))

ggsave("plots/research_output_by_institution.png", plot = p5, width = 12, height = 8, dpi = 150)
print(p5)

# Institutional impact analysis
p6 <- ggplot(institution_stats, aes(x = paper_count, y = avg_citations)) +
  geom_point(aes(size = total_citations, color = research_areas), alpha = 0.6) +
  geom_text(aes(label = ifelse(paper_count > quantile(paper_count, 0.95, na.rm = TRUE) | 
                               avg_citations > quantile(avg_citations, 0.95, na.rm = TRUE), 
                               substr(institution, 1, 20), "")), 
            hjust = 0, vjust = 0, size = 3, check_overlap = TRUE) +
  scale_color_gradient(low = "orange", high = "red", name = "Research\nAreas") +
  scale_size_continuous(name = "Total\nCitations") +
  labs(title = "Institution Analysis: Productivity vs Impact",
       subtitle = "Size = Total citations, Color = Number of research areas",
       x = "Number of Papers",
       y = "Average Citations per Paper") +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5),
        plot.subtitle = element_text(hjust = 0.5))

ggsave("plots/institution_productivity_vs_impact.png", plot = p6, width = 12, height = 8, dpi = 150)
print(p6)
```

# 5. Where is the newer research headed?

```{r research-trends}
cat("\n=== Research Trend Analysis ===\n\n")

# Analyze recent research trends
recent_years <- nodes_all %>%
  filter(!is.na(year), year >= 2015) %>%
  group_by(year, subtopic) %>%
  summarise(paper_count = n(), .groups = 'drop') %>%
  group_by(year) %>%
  mutate(year_total = sum(paper_count),
         percentage = paper_count / year_total * 100) %>%
  ungroup()

# Find fastest growing research areas
growth_analysis <- recent_years %>%
  group_by(subtopic) %>%
  summarise(
    total_papers = sum(paper_count),
    years_active = n_distinct(year),
    latest_year_papers = sum(paper_count[year == max(year)]),
    earliest_year_papers = sum(paper_count[year == min(year)]),
    .groups = 'drop'
  ) %>%
  filter(years_active >= 3, total_papers >= 10) %>%
  mutate(growth_rate = (latest_year_papers - earliest_year_papers) / earliest_year_papers * 100) %>%
  arrange(desc(growth_rate))

cat("Fastest growing research areas (since 2015):\n")
kable(head(growth_analysis[growth_analysis$growth_rate > 0, ], 15))

# Emerging research areas (appeared only in recent years)
emerging_topics <- nodes_all %>%
  filter(!is.na(year)) %>%
  group_by(subtopic) %>%
  summarise(
    first_appearance = min(year, na.rm = TRUE),
    paper_count = n(),
    avg_citations = mean(citations, na.rm = TRUE),
    .groups = 'drop'
  ) %>%
  filter(first_appearance >= 2018, paper_count >= 5) %>%
  arrange(desc(paper_count))

cat("\nEmerging research areas (first appeared in 2018 or later with significant scale):\n")
kable(emerging_topics)

# Visualize research trends
trending_topics <- head(growth_analysis[growth_analysis$growth_rate > 0, ], 10)$subtopic

trend_data <- recent_years %>%
  filter(subtopic %in% trending_topics) %>%
  group_by(year) %>%
  mutate(year_total = sum(paper_count)) %>%
  ungroup() %>%
  mutate(percentage = paper_count / year_total * 100)

p7 <- ggplot(trend_data, aes(x = year, y = percentage, color = subtopic)) +
  geom_line(size = 1.2, alpha = 0.8) +
  geom_point(size = 2) +
  labs(title = "Research Trends: Fastest Growing Subtopics",
       subtitle = "Percentage of total papers by year (2015 onwards)",
       x = "Year",
       y = "Percentage of Total Papers",
       color = "Research Subtopic") +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5),
        plot.subtitle = element_text(hjust = 0.5),
        legend.position = "bottom",
        legend.text = element_text(size = 8)) +
  guides(color = guide_legend(ncol = 2))

ggsave("plots/research_trends_over_time.png", plot = p7, width = 14, height = 10, dpi = 150)
print(p7)

# Annual research topic word cloud (last 5 years)
recent_subtopics <- nodes_all %>%
  filter(!is.na(year), year >= 2019) %>%
  count(subtopic, sort = TRUE) %>%
  filter(!is.na(subtopic), subtopic != "")

if(nrow(recent_subtopics) > 0) {
  png("plots/recent_research_trends_wordcloud.png", width = 800, height = 600, res = 150)
  wordcloud(words = recent_subtopics$subtopic, 
           freq = recent_subtopics$n, 
           min.freq = 1,
           max.words = 80, 
           random.order = FALSE, 
           rot.perc = 0.35,
           colors = brewer.pal(8, "Set2"))
  dev.off()
}

# Popular vs emerging topics comparison
topic_classification <- nodes_all %>%
  filter(!is.na(year), !is.na(subtopic)) %>%
  group_by(subtopic) %>%
  summarise(
    first_year = min(year),
    last_year = max(year),
    total_papers = n(),
    recent_papers = sum(year >= 2018),
    .groups = 'drop'
  ) %>%
  mutate(
    topic_type = case_when(
      first_year >= 2018 ~ "Emerging",
      recent_papers / total_papers >= 0.5 ~ "Growing",
      total_papers >= 50 ~ "Established",
      TRUE ~ "Declining"
    )
  )

p8 <- ggplot(topic_classification, aes(x = first_year, y = total_papers, color = topic_type)) +
  geom_point(aes(size = recent_papers), alpha = 0.7) +
  scale_color_manual(values = c("Emerging" = "red", "Growing" = "orange", 
                               "Established" = "blue", "Declining" = "gray")) +
  labs(title = "Research Topic Lifecycle Analysis",
       subtitle = "Size = Recent papers (2018+), Color = Topic classification",
       x = "First Appearance Year",
       y = "Total Number of Papers",
       color = "Topic Type",
       size = "Recent Papers") +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5),
        plot.subtitle = element_text(hjust = 0.5))

ggsave("plots/research_topic_lifecycle.png", plot = p8, width = 12, height = 8, dpi = 150)
print(p8)
```

# Summary

```{r summary}
cat("=== Analysis Summary ===\n\n")

cat("1. Most impactful paper:\n")
cat("   - Highest PageRank score:", top_impact$title[1], "\n")
cat("   - Publication year:", top_impact$year[1], "\n")
cat("   - PageRank value:", round(top_impact$pagerank[1], 6), "\n")
cat("   - Citation count:", top_impact$citations[1], "\n\n")

if(nrow(earliest_high_impact) > 0) {
  cat("2. Oldest but still relevant paper:\n")
  cat("   - Earliest high-impact paper:", earliest_high_impact$title[1], "\n")
  cat("   - Publication year:", earliest_high_impact$year[1], "\n\n")
}

cat("3. Subtopics with highest research concentration:\n")
for(i in 1:5) {
  cat("   -", subtopic_stats$subtopic[i], "(", subtopic_stats$paper_count[i], "papers)\n")
}

cat("\n4. Institutions with most research output:\n")
for(i in 1:5) {
  cat("   -", institution_stats$institution[i], "(", institution_stats$paper_count[i], "papers)\n")
}

cat("\n5. Emerging research trends:\n")
if(nrow(emerging_topics) > 0) {
  for(i in 1:min(5, nrow(emerging_topics))) {
    cat("   -", emerging_topics$subtopic[i], "(first appeared:", emerging_topics$first_appearance[i], ")\n")
  }
}

cat("\nAll analysis charts have been saved to the plots/ folder.\n")
```