---
title: "Basic analysis and Network statistics"
author: "Jinxi_Hu-48528608, Samarth_Grover-38220463"
date: "2025-11-09"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## set up

```{r set up,message = FALSE, warning = FALSE}
library(readr)
library(igraph)
library(RColorBrewer)
library(ggplot2)
library(reshape2)
library(scales)
set.seed(48528608)
```

```{r}
# Basic Analysis (Jinxi Hu)
# this file is for do some most basic analysis to the data we collected.
nodes <- read.csv("data/nodes.csv")
# only keep the node with title
nodes_clean <- subset(nodes, !(is.na(title) | trimws(title) == ""))

# head of data
head(nodes_clean)
# row and colum number
dim(nodes_clean)
# colum names
names(nodes_clean)
# type of colums
str(nodes_clean)
# summary
summary(nodes_clean)

# read edge
edges = read.csv("data/edges.csv")
# only keep valid edges
edges_clean <- subset(edges, source %in% nodes_clean$local_id & 
                        target %in% nodes_clean$local_id)
# number of cititations
dim(edges_clean)

# form graph
graph <- graph_from_data_frame(edges_clean, nodes_clean, directed = FALSE)
# remove the parallel edges and self loops
graph <- simplify(graph, remove.multiple = TRUE, remove.loops = TRUE)
# nodes in graph
vcount(graph)
# edges in graph
ecount(graph)
```

```{r draw basic graph}
# plot graph (color by university)
institutions <- unique(V(graph)$institution)
palette <- brewer.pal(min(length(institutions), 8), "Set2")
color_map <- setNames(rep(palette, length.out = length(institutions)), 
                      institutions)
V(graph)$color <- color_map[V(graph)$institution]

plot(graph, vertex.size=2, edge.size=0.1, vertex.color=V(graph)$color,
     main="Overall network (colored by university)", vertex.label=NA)
```

```{r}
# Initial Network Statistics (Samarth Grover)
cat("=== NETWORK STATISTICS ===\n")
cat("Total nodes:", vcount(graph), "\n")
cat("Total edges (citations):", ecount(graph), "\n")
cat("Network density:", edge_density(graph), "\n")
cat("Average degree:", mean(degree(graph, mode="all")), "\n")
cat("Average in-degree (citations received):", 
    mean(degree(graph, mode="in")), "\n")
cat("Average out-degree (citations made):", 
    mean(degree(graph, mode="out")), "\n\n")
```

```{r}
# Analyze isolated components
cat("=== COMPONENT ANALYSIS ===\n")
components <- components(graph, mode="weak")
cat("Number of weakly connected components:", components$no, "\n")
cat("Size of largest component:", max(components$csize), "\n")
cat("Proportion of nodes in largest component:", 
    round(max(components$csize) / vcount(graph) * 100, 2), "%\n\n")

# Count isolated nodes
isolated_count <- sum(degree(graph, mode="all") == 0)
cat("Number of isolated nodes (no citations in or out):", 
    isolated_count, "\n")
cat("Proportion of isolated nodes:", 
    round(isolated_count / vcount(graph) * 100, 2), "%\n")
```

```{r draw graph without isolated nodes}
# Remove isolated nodes for cleaner visualization
non_isolated <- V(graph)[degree(graph, mode="all") > 0]
graph_connected <- induced_subgraph(graph, non_isolated)

# plot graph without isolated nodes (color by university)
institutions_connected <- unique(V(graph_connected)$institution)
palette_connected <- brewer.pal(min(length(institutions_connected), 8), "Set2")
color_map_connected <- setNames(rep(palette_connected, 
                                length.out = length(institutions_connected)), 
                                institutions_connected)
V(graph_connected)$color <- color_map_connected[V(graph_connected)$institution]

plot(graph_connected, vertex.size=2, edge.size=0.1, 
     vertex.color=V(graph_connected)$color,
     main="Network without isolated nodes (colored by university)", 
     vertex.label=NA)
```

```{r using updated new data separated from isolated}
library(igraph)
nodes2 <- read.csv("data/nodes_connected.csv")
edges2 <- read.csv("data/edges_connected.csv")

head(nodes2)
dim(nodes2)
names(nodes2)
str(nodes2)
summary(nodes2)

graph2 <- graph_from_data_frame(edges2, vertices = nodes2, directed = TRUE)
graph2 <- simplify(graph2, remove.multiple = TRUE, remove.loops = TRUE)

```

```{r draw basic graph2}
# plot graph (color by university)
institutions <- unique(V(graph2)$institution)
palette <- brewer.pal(min(length(institutions), 8), "Set2")
color_map <- setNames(rep(palette, length.out = length(institutions)), 
                      institutions)
V(graph2)$color <- color_map[V(graph2)$institution]

plot(graph2, vertex.size=3, edge.size=1, vertex.color=V(graph2)$color,
     main="Overall network (colored by university)", 
     vertex.label=NA, edge.arrow.size=0.5)
```

```{r}

cat("Total nodes:", vcount(graph2), "\n")
cat("Total edges (citations):", ecount(graph2), "\n")
cat("Network density:", edge_density(graph2), "\n")
cat("Average degree:", mean(degree(graph2, mode="all")), "\n")
cat("Average in-degree (citations received):", 
    mean(degree(graph2, mode="in")), "\n")
cat("Average out-degree (citations made):", 
    mean(degree(graph2, mode="out")), "\n\n")
```

```{r}
# Component Analysis
cat("=== COMPONENT ANALYSIS ===\n")
components <- components(graph2, mode="weak")
cat("Number of weakly connected components:", components$no, "\n")
cat("Size of largest component:", max(components$csize), "\n")
cat("Proportion of nodes in largest component:",
    round(max(components$csize) / vcount(graph2) * 100, 2), "%\n\n")
```

```{r visualize-by-subtopic}
top_subtopics <- names(sort(table(V(graph2)$subtopic), 
                            decreasing = TRUE)[1:10])
V(graph2)$subtopic_group <- ifelse(V(graph2)$subtopic %in% top_subtopics,
                                   V(graph2)$subtopic, "Other")

# Create color palette
subtopic_groups <- unique(V(graph2)$subtopic_group)
n_groups <- length(subtopic_groups)
palette_sub <- c(brewer.pal(min(n_groups-1, 11), "Paired"), "gray80")
color_map_sub <- setNames(palette_sub[1:n_groups], subtopic_groups)
V(graph2)$color <- color_map_sub[V(graph2)$subtopic_group]

# Plot
plot(graph2, vertex.size=2, edge.arrow.size=0.2, vertex.color=V(graph2)$color,
     main="Citation Network (colored by subtopic)", vertex.label=NA)
legend("bottomleft", legend=names(color_map_sub), fill=color_map_sub,
       cex=0.6, title="Subtopic", ncol=2)
```

```{r calculate-centralities}

# Calculate all centrality metrics
V(graph2)$in_degree <- degree(graph2, mode="in")
V(graph2)$out_degree <- degree(graph2, mode="out")
V(graph2)$total_degree <- degree(graph2, mode="all")

# PageRank (influence - highly cited by other highly cited papers)
V(graph2)$pagerank <- page_rank(graph2, directed = TRUE)$vector

# Betweenness (bridging papers, potentially unifying ideas)
V(graph2)$betweenness <- betweenness(graph2, directed = TRUE, normalized = TRUE)

# Closeness (foundational papers)
V(graph2)$closeness_out <- closeness(graph2, mode = "out", normalized = TRUE)
V(graph2)$closeness_in <- closeness(graph2, mode = "in", normalized = TRUE)

# Eigenvector centrality (alternative influence measure)
V(graph2)$eigenvector <- eigen_centrality(graph2, directed = TRUE)$vector
```

## Analyze the isolated nodes (Jinxi Hu)

```{r analyze-isolated-nodes}
# Load isolated nodes data
nodes_isolated <- read.csv("data/nodes_isolated.csv")

cat("=== ISOLATED NODES ANALYSIS ===\n")
cat("Total isolated nodes:", nrow(nodes_isolated), "\n")
cat("Isolated nodes have no citations in or out\n\n")

# Basic statistics for isolated nodes
cat("Year range for isolated papers:", min(nodes_isolated$year, na.rm=TRUE), "-", 
    max(nodes_isolated$year, na.rm=TRUE), "\n")
cat("Average citations for isolated papers:", 
    round(mean(nodes_isolated$citations, na.rm=TRUE), 2), "\n")
cat("Average references for isolated papers:", 
    round(mean(nodes_isolated$references, na.rm=TRUE), 2), "\n\n")
```

```{r histogram-isolated-subtopics}
# Frequency analysis by research subtopic for isolated nodes

# Count frequency of subtopics in isolated nodes
subtopic_freq_isolated <- table(nodes_isolated$subtopic)
subtopic_df_isolated <- data.frame(
  subtopic = names(subtopic_freq_isolated),
  frequency = as.numeric(subtopic_freq_isolated)
)
subtopic_df_isolated <- subtopic_df_isolated[order(
  subtopic_df_isolated$frequency, decreasing = TRUE), ]

# Create histogram for subtopics (isolated nodes)
ggplot(subtopic_df_isolated, aes(x = reorder(subtopic, frequency), 
                                 y = frequency)) +
  geom_bar(stat = "identity", fill = "lightcoral", alpha = 0.7) +
  coord_flip() +
  labs(title = "Research Subtopic Distribution - Isolated Nodes",
       subtitle = paste("Total of", nrow(nodes_isolated), "isolated nodes"),
       x = "Research Subtopic",
       y = "Frequency") +
  theme_minimal() +
  theme(axis.text.y = element_text(size = 8),
        plot.title = element_text(hjust = 0.5),
        plot.subtitle = element_text(hjust = 0.5))

# Print top subtopics for isolated nodes
cat("Top 10 research subtopics in isolated nodes:\n")
print(head(subtopic_df_isolated, 10))
```

```{r histogram-isolated-institutions}
# Frequency analysis by institution for isolated nodes

# Count frequency of institutions in isolated nodes
institution_freq_isolated <- table(nodes_isolated$institution)
institution_df_isolated <- data.frame(
  institution = names(institution_freq_isolated),
  frequency = as.numeric(institution_freq_isolated)
)
institution_df_isolated <- institution_df_isolated[order(
  institution_df_isolated$frequency, decreasing = TRUE), ]

# Show only top 20 institutions for better visualization
top_institutions_isolated <- head(institution_df_isolated, 20)

# Create histogram for institutions (isolated nodes)
ggplot(top_institutions_isolated, aes(x = reorder(institution, frequency), 
                                      y = frequency)) +
  geom_bar(stat = "identity", fill = "lightblue", alpha = 0.7) +
  coord_flip() +
  labs(title = "Institution Distribution - Isolated Nodes (Top 20)",
       subtitle = paste("Total of", nrow(nodes_isolated), 
        "isolated nodes, showing top 20 institutions"),
        x = "Institution",
        y = "Frequency") +
  theme_minimal() +
  theme(axis.text.y = element_text(size = 8),
        plot.title = element_text(hjust = 0.5),
        plot.subtitle = element_text(hjust = 0.5))

# Print top institutions for isolated nodes
cat("\nTop 15 institutions with isolated nodes:\n")
print(head(institution_df_isolated, 15))
```

```{r compare-isolated-vs-connected}
# Compare isolated vs connected nodes

# For connected nodes
subtopic_freq_connected <- table(V(graph2)$subtopic)
institution_freq_connected <- table(V(graph2)$institution)

# Create comparison data frame for subtopics
subtopic_comparison <- data.frame(
  subtopic = unique(c(names(subtopic_freq_isolated), 
                      names(subtopic_freq_connected))),
  isolated = 0,
  connected = 0
)

# Fill in frequencies
for(i in 1:nrow(subtopic_comparison)) {
  topic <- subtopic_comparison$subtopic[i]
  subtopic_comparison$isolated[i] <- ifelse(
    topic %in% names(subtopic_freq_isolated), 
    subtopic_freq_isolated[topic], 0)
  subtopic_comparison$connected[i] <- ifelse(
    topic %in% names(subtopic_freq_connected), 
    subtopic_freq_connected[topic], 0)
}

# Calculate proportions
subtopic_comparison$total <- subtopic_comparison$isolated + subtopic_comparison$connected
subtopic_comparison$isolated_prop <- subtopic_comparison$
  isolated / subtopic_comparison$total
subtopic_comparison <- subtopic_comparison[order(
  subtopic_comparison$isolated_prop, decreasing = TRUE), ]

cat("\n=== COMPARISON: ISOLATED vs CONNECTED NODES ===\n")
cat("Research subtopics with highest isolation rates:\n")
print(head(subtopic_comparison[subtopic_comparison$total >= 5, 
                               c("subtopic", "isolated", "connected", 
                                 "isolated_prop")], 10))
```

```{r histogram-comparison-subtopics}
# Visualize comparison of isolated vs connected by subtopic

# Prepare data for comparison plot (top 15 subtopics by total count)
top_subtopics_total <- head(subtopic_comparison[order(subtopic_comparison$total, 
                                                      decreasing = TRUE), ], 15)
comparison_melted <- melt(top_subtopics_total[, 
                         c("subtopic", "isolated", "connected")], 
                         id.vars = "subtopic", 
                         variable.name = "type", 
                         value.name = "count")

# Create stacked bar chart
ggplot(comparison_melted, aes(x = reorder(subtopic, count), y = count, 
                              fill = type)) +
  geom_bar(stat = "identity") +
  coord_flip() +
  scale_fill_manual(values = c("isolated" = "lightcoral", 
                               "connected" = "lightblue"),
                    labels = c("Isolated Nodes", "Connected Nodes")) +
  labs(title = "Research Subtopic Distribution Comparison: 
       Isolated vs Connected Nodes",
       subtitle = "Top 15 research subtopics ordered by total paper count",
       x = "Research Subtopic",
       y = "Number of Papers",
       fill = "Node Type") +
  theme_minimal() +
  theme(axis.text.y = element_text(size = 8),
        plot.title = element_text(hjust = 0.5),
        plot.subtitle = element_text(hjust = 0.5),
        legend.position = "bottom")
```

## Analyze the connected nodes (Jinxi Hu)

```{r analyze-connected-nodes}
# Analyze connected nodes (non-isolated nodes)
cat("=== CONNECTED NODES ANALYSIS ===\n")
cat("Total connected nodes:", nrow(nodes2), "\n")
cat("Connected nodes have at least one citation in or out\n\n")

# Basic statistics for connected nodes
cat("Year range for connected papers:", min(nodes2$year, na.rm=TRUE), "-", 
    max(nodes2$year, na.rm=TRUE), "\n")
cat("Average citations for connected papers:", 
    round(mean(nodes2$citations, na.rm=TRUE), 2), "\n")
cat("Average references for connected papers:", 
    round(mean(nodes2$references, na.rm=TRUE), 2), "\n\n")
```

```{r histogram-connected-subtopics}
# Frequency analysis by research subtopic for connected nodes

# Count frequency of subtopics in connected nodes
subtopic_freq_connected_detailed <- table(nodes2$subtopic)
subtopic_df_connected <- data.frame(
  subtopic = names(subtopic_freq_connected_detailed),
  frequency = as.numeric(subtopic_freq_connected_detailed)
)
subtopic_df_connected <- subtopic_df_connected[order(
  subtopic_df_connected$frequency, decreasing = TRUE), ]

# Create histogram for subtopics (connected nodes)
ggplot(subtopic_df_connected, aes(x = reorder(subtopic, frequency), 
                                  y = frequency)) +
  geom_bar(stat = "identity", fill = "lightgreen", alpha = 0.7) +
  coord_flip() +
  labs(title = "Research Subtopic Distribution - Connected Nodes",
       subtitle = paste("Total of", nrow(nodes2), "connected nodes"),
       x = "Research Subtopic",
       y = "Frequency") +
  theme_minimal() +
  theme(axis.text.y = element_text(size = 8),
        plot.title = element_text(hjust = 0.5),
        plot.subtitle = element_text(hjust = 0.5))

# Print top subtopics for connected nodes
cat("Top 10 research subtopics in connected nodes:\n")
print(head(subtopic_df_connected, 10))
```

```{r histogram-connected-institutions}
# Frequency analysis by institution for connected nodes

# Count frequency of institutions in connected nodes
institution_freq_connected_detailed <- table(nodes2$institution)
institution_df_connected <- data.frame(
  institution = names(institution_freq_connected_detailed),
  frequency = as.numeric(institution_freq_connected_detailed)
)
institution_df_connected <- institution_df_connected[order(
  institution_df_connected$frequency, decreasing = TRUE), ]

# Show only top 20 institutions for better visualization
top_institutions_connected <- head(institution_df_connected, 20)

# Create histogram for institutions (connected nodes)
ggplot(top_institutions_connected, aes(x = reorder(institution, frequency), 
                                       y = frequency)) +
  geom_bar(stat = "identity", fill = "lightsteelblue", alpha = 0.7) +
  coord_flip() +
  labs(title = "Institution Distribution - Connected Nodes (Top 20)",
       subtitle = paste("Total of", nrow(nodes2), 
                       "connected nodes, showing top 20 institutions"),
       x = "Institution",
       y = "Frequency") +
  theme_minimal() +
  theme(axis.text.y = element_text(size = 8),
        plot.title = element_text(hjust = 0.5),
        plot.subtitle = element_text(hjust = 0.5))

# Print top institutions for connected nodes
cat("\nTop 15 institutions with connected nodes:\n")
print(head(institution_df_connected, 15))
```

```{r detailed-comparison-analysis}
# Detailed comparison between isolated and connected nodes

cat("\n=== DETAILED COMPARISON ANALYSIS ===\n")

# Compare basic statistics
cat("BASIC STATISTICS COMPARISON:\n")
cat("Isolated nodes - Average citations:", 
    round(mean(nodes_isolated$citations, na.rm=TRUE), 2), "\n")
cat("Connected nodes - Average citations:", 
    round(mean(nodes2$citations, na.rm=TRUE), 2), "\n")
cat("Isolated nodes - Average references:", 
    round(mean(nodes_isolated$references, na.rm=TRUE), 2), "\n")
cat("Connected nodes - Average references:", 
    round(mean(nodes2$references, na.rm=TRUE), 2), "\n\n")

# Top institutions comparison
cat("TOP INSTITUTIONS COMPARISON:\n")
cat("Top 5 institutions in isolated nodes:\n")
print(head(institution_df_isolated, 5))
cat("\nTop 5 institutions in connected nodes:\n")
print(head(institution_df_connected, 5))

# Top subtopics comparison  
cat("\nTOP SUBTOPICS COMPARISON:\n")
cat("Top 5 subtopics in isolated nodes:\n")
print(head(subtopic_df_isolated, 5))
cat("\nTop 5 subtopics in connected nodes:\n")
print(head(subtopic_df_connected, 5))
```

```{r side-by-side-comparison-plots}
# Create side-by-side comparison plots

# Prepare data for subtopic comparison (top 10 from each)
top_isolated_subtopics <- head(subtopic_df_isolated, 10)
top_connected_subtopics <- head(subtopic_df_connected, 10)

# Combine and label data
top_isolated_subtopics$type <- "Isolated"
top_connected_subtopics$type <- "Connected"

combined_subtopics <- rbind(
  top_isolated_subtopics[, c("subtopic", "frequency", "type")],
  top_connected_subtopics[, c("subtopic", "frequency", "type")]
)

# Create faceted plot for subtopic comparison
ggplot(combined_subtopics, aes(x = reorder(subtopic, frequency), 
                               y = frequency, fill = type)) +
  geom_bar(stat = "identity") +
  coord_flip() +
  facet_wrap(~type, scales = "free") +
  scale_fill_manual(values = c("Isolated" = "lightcoral", 
                               "Connected" = "lightgreen")) +
  labs(title = "Top Research Subtopics: Isolated vs Connected Nodes",
       subtitle = "Top 10 subtopics for each node type",
       x = "Research Subtopic",
       y = "Frequency") +
  theme_minimal() +
  theme(axis.text.y = element_text(size = 7),
        plot.title = element_text(hjust = 0.5),
        plot.subtitle = element_text(hjust = 0.5),
        legend.position = "none",
        strip.text = element_text(size = 10, face = "bold"))
```

```{r institution-comparison-plot}
# Institution comparison plot
top_isolated_institutions <- head(institution_df_isolated, 10)
top_connected_institutions <- head(institution_df_connected, 10)

# Combine and label data
top_isolated_institutions$type <- "Isolated"
top_connected_institutions$type <- "Connected"

combined_institutions <- rbind(
  top_isolated_institutions[, c("institution", "frequency", "type")],
  top_connected_institutions[, c("institution", "frequency", "type")]
)

# Create faceted plot for institution comparison
ggplot(combined_institutions, aes(x = reorder(institution, frequency), 
                                  y = frequency, fill = type)) +
  geom_bar(stat = "identity") +
  coord_flip() +
  facet_wrap(~type, scales = "free") +
  scale_fill_manual(values = c("Isolated" = "lightblue", 
                               "Connected" = "lightsteelblue")) +
  labs(title = "Top Institutions: Isolated vs Connected Nodes",
       subtitle = "Top 10 institutions for each node type",
       x = "Institution",
       y = "Frequency") +
  theme_minimal() +
  theme(axis.text.y = element_text(size = 7),
        plot.title = element_text(hjust = 0.5),
        plot.subtitle = element_text(hjust = 0.5),
        legend.position = "none",
        strip.text = element_text(size = 10, face = "bold"))
```
