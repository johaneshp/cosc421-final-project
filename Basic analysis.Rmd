---
title: "Basic analysis and Network statistics"
author: "Jinxi_Hu-48528608, Samarth_Grover-38220463"
date: "2025-11-09"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, message = FALSE, warning = FALSE}
library(readr)
library(igraph)
library(RColorBrewer)
set.seed(48528608)
```
```{r}
# Basic Analysis (Jinxi Hu)
# this file is for do some most basic analysis to the data we collected.
nodes <- read.csv("data/nodes.csv")
# only keep the node with title
nodes_clean <- subset(nodes, !(is.na(title) | trimws(title) == ""))

# head of data
head(nodes_clean)
# row and colum number
dim(nodes_clean)
# colum names
names(nodes_clean)
# type of colums
str(nodes_clean)
# summary
summary(nodes_clean)

# read edge
edges = read.csv("data/edges.csv")
# only keep valid edges
edges_clean <- subset(edges, source %in% nodes_clean$local_id & target %in% nodes_clean$local_id)
# number of cititations
dim(edges_clean)

# form graph
graph <- graph_from_data_frame(edges_clean, nodes_clean, directed = FALSE)
# remove the parallel edges and self loops
graph <- simplify(graph, remove.multiple = TRUE, remove.loops = TRUE)
# nodes in graph
vcount(graph)
# edges in graph
ecount(graph)
```

```{r draw basic graph}
# plot graph (color by university)
institutions <- unique(V(graph)$institution)
palette <- brewer.pal(min(length(institutions), 8), "Set2")
color_map <- setNames(rep(palette, length.out = length(institutions)), institutions)
V(graph)$color <- color_map[V(graph)$institution]

plot(graph, vertex.size=2, edge.size=0.1, vertex.color=V(graph)$color,
     main="Overall network (colored by university)", vertex.label=NA)
```


```{r}
# Initial Network Statistics (Samarth Grover)
cat("=== NETWORK STATISTICS ===\n")
cat("Total nodes:", vcount(graph), "\n")
cat("Total edges (citations):", ecount(graph), "\n")
cat("Network density:", edge_density(graph), "\n")
cat("Average degree:", mean(degree(graph, mode="all")), "\n")
cat("Average in-degree (citations received):", mean(degree(graph, mode="in")), "\n")
cat("Average out-degree (citations made):", mean(degree(graph, mode="out")), "\n\n")
```

```{r}
# Analyze isolated components
cat("=== COMPONENT ANALYSIS ===\n")
components <- components(graph, mode="weak")
cat("Number of weakly connected components:", components$no, "\n")
cat("Size of largest component:", max(components$csize), "\n")
cat("Proportion of nodes in largest component:", 
    round(max(components$csize) / vcount(graph) * 100, 2), "%\n\n")

# Count isolated nodes
isolated_count <- sum(degree(graph, mode="all") == 0)
cat("Number of isolated nodes (no citations in or out):", isolated_count, "\n")
cat("Proportion of isolated nodes:", 
    round(isolated_count / vcount(graph) * 100, 2), "%\n")
```
```{r draw graph without isolated nodes}
# Remove isolated nodes for cleaner visualization
non_isolated <- V(graph)[degree(graph, mode="all") > 0]
graph_connected <- induced_subgraph(graph, non_isolated)

# plot graph without isolated nodes (color by university)
institutions_connected <- unique(V(graph_connected)$institution)
palette_connected <- brewer.pal(min(length(institutions_connected), 8), "Set2")
color_map_connected <- setNames(rep(palette_connected, length.out = length(institutions_connected)), 
                                institutions_connected)
V(graph_connected)$color <- color_map_connected[V(graph_connected)$institution]

plot(graph_connected, vertex.size=2, edge.size=0.1, vertex.color=V(graph_connected)$color,
     main="Network without isolated nodes (colored by university)", vertex.label=NA)
```

```{r using updated new data separated from isolated}
library(igraph)
nodes2 <- read.csv("data/nodes_connected.csv")
edges2 <- read.csv("data/edges_connected.csv")

head(nodes2)
dim(nodes2)
names(nodes2)
str(nodes2)
summary(nodes2)

graph2 <- graph_from_data_frame(edges2, vertices = nodes2, directed = TRUE)
graph2 <- simplify(graph2, remove.multiple = TRUE, remove.loops = TRUE)

```

```{r draw basic graph2}
# plot graph (color by university)
institutions <- unique(V(graph2)$institution)
palette <- brewer.pal(min(length(institutions), 8), "Set2")
color_map <- setNames(rep(palette, length.out = length(institutions)), institutions)
V(graph2)$color <- color_map[V(graph2)$institution]

plot(graph2, vertex.size=3, edge.size=1, vertex.color=V(graph2)$color,
     main="Overall network (colored by university)", vertex.label=NA, edge.arrow.size=0.5)
```

```{r}

cat("Total nodes:", vcount(graph2), "\n")
cat("Total edges (citations):", ecount(graph2), "\n")
cat("Network density:", edge_density(graph2), "\n")
cat("Average degree:", mean(degree(graph2, mode="all")), "\n")
cat("Average in-degree (citations received):", mean(degree(graph2, mode="in")), "\n")
cat("Average out-degree (citations made):", mean(degree(graph2, mode="out")), "\n\n")
```

```{r}
# Component Analysis
cat("=== COMPONENT ANALYSIS ===\n")
components <- components(graph2, mode="weak")
cat("Number of weakly connected components:", components$no, "\n")
cat("Size of largest component:", max(components$csize), "\n")
cat("Proportion of nodes in largest component:",
    round(max(components$csize) / vcount(graph2) * 100, 2), "%\n\n")
```

```{r visualize-by-subtopic}
top_subtopics <- names(sort(table(V(graph2)$subtopic), decreasing = TRUE)[1:10])
V(graph2)$subtopic_group <- ifelse(V(graph2)$subtopic %in% top_subtopics,
                                   V(graph2)$subtopic, "Other")

# Create color palette
subtopic_groups <- unique(V(graph2)$subtopic_group)
n_groups <- length(subtopic_groups)
palette_sub <- c(brewer.pal(min(n_groups-1, 11), "Paired"), "gray80")
color_map_sub <- setNames(palette_sub[1:n_groups], subtopic_groups)
V(graph2)$color <- color_map_sub[V(graph2)$subtopic_group]

# Plot
plot(graph2, vertex.size=2, edge.arrow.size=0.2, vertex.color=V(graph2)$color,
     main="Citation Network (colored by subtopic)", vertex.label=NA)
legend("bottomleft", legend=names(color_map_sub), fill=color_map_sub,
       cex=0.6, title="Subtopic", ncol=2)
```

```{r calculate-centralities}

# Calculate all centrality metrics
V(graph2)$in_degree <- degree(graph2, mode="in")
V(graph2)$out_degree <- degree(graph2, mode="out")
V(graph2)$total_degree <- degree(graph2, mode="all")

# PageRank (influence - highly cited by other highly cited papers)
V(graph2)$pagerank <- page_rank(graph2, directed = TRUE)$vector

# Betweenness (bridging papers, potentially unifying ideas)
V(graph2)$betweenness <- betweenness(graph2, directed = TRUE, normalized = TRUE)

# Closeness (foundational papers)
V(graph2)$closeness_out <- closeness(graph2, mode = "out", normalized = TRUE)
V(graph2)$closeness_in <- closeness(graph2, mode = "in", normalized = TRUE)

# Eigenvector centrality (alternative influence measure)
V(graph2)$eigenvector <- eigen_centrality(graph2, directed = TRUE)$vector
```




